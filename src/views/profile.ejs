<%- include('./partials/header') %>

<body class="body-profil" data-userid="<%= user.id_user %>">
  <div class="page-wrapper">
    <div class="container">
      <section class="profile-section">
        <h1 class="profile-title">MON PROFIL</h1>

        <section class="profile">
          <div class="profile-card">
            <form
              id="upload-form"
              action="/profiles/<%= user.id_user %>/upload-picture"
              method="POST"
              enctype="multipart/form-data"
            >
              <div id="drag-drop-area" class="drop-area">
                <img
                  id="image-preview"
                  src="<%= user.picture_url ? user.picture_url : '/images/default-profile.png' %>"
                  alt="Photo de profil"
                  class="profile-img"
                />
                <input type="file" id="file-input" name="picture" hidden />
                <button
                  type="button"
                  id="select-file-btn"
                  class="edit-btn"
                  title="Changer la photo"
                >
                  <img src="/images/Icons/edit.svg" alt="Modifier" class="icon" />
                </button>
              </div>
            </form>

            <h2 class="name">
              <span class="editable" data-field="nickname"><strong><%= user.nickname %></strong></span>
              <button class="edit-btn" data-field="nickname" title="Modifier le pseudo">
                <img src="/images/Icons/edit.svg" alt="Modifier" class="icon" />
              </button>
            </h2>
          </div>
        </section>

        <div class="bio-delete-wrapper">
          <div class="bio">
            <h3>Présentation</h3>
            <p class="editable" data-field="description"><%= user.description %></p>
            <button class="edit-btn" data-field="description" title="Modifier ma présentation">
              <img src="/images/Icons/edit.svg" alt="Modifier" class="icon" />
            </button>
          </div>

          <form
            method="POST"
            action="/profiles/<%= user.id_user %>/delete"
            style="display: inline"
          >
            <button
              type="submit"
              class="delete-account"
              onclick="return confirm('Confirmer la suppression ?')"
            >
              Supprimer mon compte
            </button>
          </form>
        </div>
      </section>

      <section class="recipes">
        <h2>MES RECETTES</h2>
        <div class="recipe-grid">
          <% if (user.recipes && user.recipes.length) { %>
            <% user.recipes.forEach(recipe => { %>
              <div class="recipe-card">
                <img
                  src="<%= recipe.image_url %>"
                  alt="<%= recipe.name %>"
                />
                <h3><%= recipe.name %></h3>
                <p class="film">
                  <em><%= recipe.movie ? recipe.movie.title : '' %></em>
                </p>
                <div class="actions">
                  <a
                    href="/recipes/<%= recipe.id_recipe %>/edit"
                    class="edit-btn"
                    title="Modifier"
                  >
                    <img src="/images/Icons/edit.svg" alt="Modifier" class="icon" />
                  </a>
                  <form action="/recipes/<%= recipe.id_recipe %>/delete" method="POST" onsubmit="return confirm('Confirmer la suppression ?')">
                    <button type="submit" class="delete-btn" title="Supprimer">
                      <img src="/images/Icons/delete.svg" alt="Supprimer" class="icon" />
                    </button>
                  </form>
                </div>
              </div>
            <% }) %>
          <% } else { %>
            <p>Aucune recette trouvée.</p>
          <% } %>
        </div>
      </section>
    </div>

    <%- include('./partials/footer') %>
  </div>
  <script src="/js/profile-photo-upload.js" defer></script>
  <script src="/js/profile-inline-edit.js" defer></script>
</body>
